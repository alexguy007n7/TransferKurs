<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransferPile ¬∑ Room + Unlimited</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f5f7fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 24px;
        }

        .app {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 24px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.04);
            padding: 32px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            color: #0a1e2f;
            letter-spacing: -0.01em;
        }

        .badge {
            background: #e6f0fa;
            color: #0066cc;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 14px;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 15px;
            color: #4a5c6a;
            cursor: pointer;
            transition: 0.1s;
        }

        .tab.active {
            background: #0a1e2f;
            color: white;
        }

        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        .upload-section {
            background: #f9fcff;
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 28px 24px;
            margin-bottom: 24px;
            transition: 0.2s;
        }

        .upload-section:hover {
            border-color: #3b82f6;
            background: #f0f7ff;
        }

        .file-input-area {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .btn {
            background: white;
            border: 1px solid #d1d9e6;
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 15px;
            color: #1e293b;
            cursor: pointer;
            transition: 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #0a1e2f;
            border: none;
            color: white;
            box-shadow: 0 4px 8px rgba(10,30,47,0.1);
        }

        .btn-primary:hover {
            background: #143750;
            transform: translateY(-1px);
        }

        .btn-small {
            padding: 8px 18px;
            font-size: 14px;
        }

        .btn:hover {
            background: #f1f5f9;
        }

        .storage-info {
            margin-top: 20px;
            font-size: 15px;
            color: #33475b;
            background: #f1f5f9;
            padding: 14px 20px;
            border-radius: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
        }

        .file-list {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 20px;
            margin: 24px 0;
            max-height: 360px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #fafcfc;
            border-radius: 16px;
            margin-bottom: 10px;
            border-left: 4px solid #3b82f6;
            transition: 0.1s;
        }

        .file-item:hover {
            background: #f1f9ff;
        }

        .file-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .file-name {
            font-weight: 600;
            color: #0f172a;
        }

        .file-meta {
            font-size: 13px;
            color: #5e6f7e;
        }

        .btn-delete, .btn-download {
            background: none;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.1s;
        }

        .btn-delete {
            color: #b22234;
        }
        .btn-delete:hover {
            background: #fee2e2;
            border-color: #b91c1c;
        }

        .btn-download {
            color: #0a1e2f;
        }
        .btn-download:hover {
            background: #e6f0fa;
            border-color: #3b82f6;
        }

        .room-control {
            background: #f1f5f9;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }

        .room-input {
            flex: 1;
            min-width: 200px;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .room-input label {
            font-weight: 600;
            color: #1e293b;
        }

        .room-input input {
            padding: 10px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 30px;
            font-size: 15px;
            flex: 1;
            min-width: 160px;
        }

        .device-section {
            margin: 28px 0 20px;
        }

        .device-title {
            font-weight: 600;
            margin-bottom: 14px;
            color: #1e293b;
            font-size: 16px;
        }

        .device-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .device-chip {
            background: white;
            border: 1px solid #d1d9e6;
            padding: 10px 22px;
            border-radius: 40px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.1s;
            color: #1e293b;
        }

        .device-chip.active {
            background: #0a1e2f;
            border-color: #0a1e2f;
            color: white;
        }

        .transfer-area {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
        }

        .status {
            color: #3b82f6;
            font-weight: 500;
            background: #eef2ff;
            padding: 10px 20px;
            border-radius: 40px;
            font-size: 14px;
        }

        .footer {
            margin-top: 32px;
            text-align: center;
            color: #6a7a8a;
            font-size: 13px;
            border-top: 1px solid #edf2f7;
            padding-top: 24px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- HEADER -->
        <div class="header">
            <span class="title">‚àû TransferPile ¬∑ Room</span>
            <span class="badge">UNLIMITED ¬∑ KEY ROOM</span>
        </div>

        <!-- TAB NAVIGASI: MY UPLOADS vs ROOM INBOX -->
        <div class="tabs">
            <div class="tab active" id="tabMyUploads">üì§ My Uploads</div>
            <div class="tab" id="tabRoomInbox">üì• Room Inbox</div>
        </div>

        <!-- ========== PANEL 1: MY UPLOADS (Upload & Transfer) ========= -->
        <div id="panelMyUploads" class="panel active">
            <!-- UPLOAD AREA -->
            <div class="upload-section" id="dropZone">
                <div class="file-input-area">
                    <label for="fileInput" class="btn">
                        <span>üìÅ</span> Pilih File (tanpa batas)
                    </label>
                    <input type="file" id="fileInput" multiple class="hidden">
                    <span style="color: #5e6f7e; font-size: 15px;">atau seret ke sini</span>
                </div>
                <div class="storage-info" id="storageInfo">
                    <span>üíæ Penyimpanan: 0 B / ‚àû</span>
                    <span>üìÑ File: 0</span>
                </div>
            </div>

            <!-- DAFTAR FILE SAYA (UPLOADED) -->
            <div class="file-list" id="fileListContainer">
                <div style="color: #64748b; text-align: center; padding: 30px;" id="emptyMessage">
                    ‚ö° Belum ada file. Upload tak terbatas dimulai.
                </div>
            </div>

            <!-- PILIH PERANGKAT TUJUAN -->
            <div class="device-section">
                <div class="device-title">üéØ Kirim ke perangkat (pilih satu / banyak)</div>
                <div class="device-grid" id="deviceSelector">
                    <div class="device-chip active" data-device="pc1">üñ•Ô∏è PC1</div>
                    <div class="device-chip" data-device="router">üì∂ Router</div>
                    <div class="device-chip" data-device="hp">üì± Android</div>
                    <div class="device-chip" data-device="pc2">üíª PC2</div>
                    <div class="device-chip" data-device="all">üåê Semua</div>
                </div>
            </div>

            <!-- TRANSFER -->
            <div class="transfer-area">
                <button class="btn btn-primary" id="transferBtn">
                    üöÄ Transfer file
                </button>
                <span class="status" id="transferStatus">Siap ‚Äì 0 file</span>
            </div>
        </div>

        <!-- ========== PANEL 2: ROOM INBOX (Lihat & Download file orang) ========= -->
        <div id="panelRoomInbox" class="panel">
            <div class="room-control">
                <div class="room-input">
                    <label>üîë Room Key:</label>
                    <input type="text" id="roomKeyInput" placeholder="Contoh: rahasia123" value="default-room">
                    <button class="btn btn-small" id="joinRoomBtn">üîÑ Join / Refresh</button>
                </div>
                <span style="color: #4a5c6a; font-size: 14px;">File di room ini dikirim oleh orang lain</span>
            </div>

            <!-- DAFTAR FILE ROOM (INCOMING) -->
            <div class="file-list" id="roomFileListContainer" style="margin-top: 0;">
                <!-- Akan diisi oleh JS -->
            </div>
            <div style="margin-top: 12px; color: #5e6f7e; text-align: right; font-size: 13px;">
                <span id="roomInfo">Menggunakan key: default-room</span>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            ‚ö° OXYX ¬∑ PROTOKOL X ¬∑ TANPA BATAS ¬∑ KEY ROOM
        </div>
    </div>

    <script>
        (function(){
            "use strict";

            // ========== STATE ==========
            // File yang diupload user sendiri (my uploads)
            let uploadedFiles = []; 

            // Simulasi file yang ada di berbagai room (key -> array of File)
            let roomDatabase = {
                "default-room": [
                    createSampleFile("laporan_keuangan_q1.pdf", "application/pdf", 2.4 * 1024 * 1024),
                    createSampleFile("foto_tim.jpg", "image/jpeg", 3.1 * 1024 * 1024),
                    createSampleFile("presentasi_client.pptx", "application/vnd.openxmlformats-officedocument.presentationml.presentation", 8.7 * 1024 * 1024)
                ],
                "project-alpha": [
                    createSampleFile("source_code_v2.zip", "application/zip", 22.1 * 1024 * 1024),
                    createSampleFile("readme.md", "text/markdown", 1.2 * 1024 * 1024)
                ],
                "private-oxy": [
                    createSampleFile("protokol_x_dokumentasi.pdf", "application/pdf", 5.6 * 1024 * 1024),
                    createSampleFile("chip_schematic.png", "image/png", 12.3 * 1024 * 1024)
                ]
            };

            // Room yang sedang aktif
            let currentRoomKey = "default-room";

            // ========== ELEMEN DOM ==========
            // Tab
            const tabMy = document.getElementById('tabMyUploads');
            const tabRoom = document.getElementById('tabRoomInbox');
            const panelMy = document.getElementById('panelMyUploads');
            const panelRoom = document.getElementById('panelRoomInbox');

            // My Uploads
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            const fileListContainer = document.getElementById('fileListContainer');
            const storageInfo = document.getElementById('storageInfo');
            const transferBtn = document.getElementById('transferBtn');
            const transferStatus = document.getElementById('transferStatus');
            const deviceChips = document.querySelectorAll('.device-chip');

            // Room Inbox
            const roomKeyInput = document.getElementById('roomKeyInput');
            const joinRoomBtn = document.getElementById('joinRoomBtn');
            const roomFileListContainer = document.getElementById('roomFileListContainer');
            const roomInfo = document.getElementById('roomInfo');

            // State perangkat
            let selectedDevices = ['pc1']; // default

            // ========== FUNGSI BANTU ==========
            function formatBytes(bytes) {
                if (bytes === Infinity || bytes > 1e30) return '‚àû TB';
                if (bytes === 0) return '0 B';
                const sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return parseFloat((bytes / Math.pow(1024, i)).toFixed(1)) + ' ' + (sizes[i] || '‚àû');
            }

            // Membuat objek File tiruan (untuk simulasi room)
            function createSampleFile(name, type, size) {
                const file = new File([""], name, { type });
                Object.defineProperty(file, 'size', { value: size });
                return file;
            }

            // Escape HTML
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // ========== RENDER MY UPLOADS ==========
            function renderMyFiles() {
                const totalSize = uploadedFiles.reduce((acc, f) => acc + (f.size || 0), 0);
                const fileCount = uploadedFiles.length;

                storageInfo.innerHTML = `
                    <span>üíæ Penyimpanan: ${formatBytes(totalSize)} / ‚àû</span>
                    <span>üìÑ File: ${fileCount}</span>
                `;
                transferStatus.innerText = fileCount === 0 ? 'Siap ‚Äì 0 file' : `Siap ‚Äì ${fileCount} file (${formatBytes(totalSize)})`;

                if (fileCount === 0) {
                    fileListContainer.innerHTML = `<div style="color: #64748b; text-align: center; padding: 30px;">‚ö° Belum ada file. Upload tak terbatas dimulai.</div>`;
                    return;
                }

                let html = '';
                uploadedFiles.forEach((file, idx) => {
                    const name = file.name || 'file';
                    const size = formatBytes(file.size || 0);
                    const type = file.type || 'application/octet-stream';
                    html += `
                        <div class="file-item" data-index="${idx}">
                            <div class="file-detail">
                                <span class="file-name">${escapeHtml(name)}</span>
                                <span class="file-meta">${size} ¬∑ ${escapeHtml(type.substring(0, 30))}</span>
                            </div>
                            <button class="btn-delete" data-index="${idx}">‚úï Hapus</button>
                        </div>
                    `;
                });
                fileListContainer.innerHTML = html;

                fileListContainer.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        const index = parseInt(this.dataset.index);
                        if (!isNaN(index) && index >= 0 && index < uploadedFiles.length) {
                            uploadedFiles.splice(index, 1);
                            renderMyFiles();
                        }
                        e.stopPropagation();
                    });
                });
            }

            // ========== RENDER ROOM INBOX ==========
            function renderRoomFiles(roomKey) {
                const files = roomDatabase[roomKey] || [];
                roomInfo.innerText = `Menggunakan key: ${roomKey} (${files.length} file)`;

                if (files.length === 0) {
                    roomFileListContainer.innerHTML = `<div style="color: #64748b; text-align: center; padding: 40px;">üì≠ Tidak ada file di room ini.</div>`;
                    return;
                }

                let html = '';
                files.forEach((file, idx) => {
                    const name = file.name || 'file';
                    const size = formatBytes(file.size || 0);
                    const type = file.type || 'application/octet-stream';
                    html += `
                        <div class="file-item" data-roomkey="${roomKey}" data-fileindex="${idx}">
                            <div class="file-detail">
                                <span class="file-name">${escapeHtml(name)}</span>
                                <span class="file-meta">${size} ¬∑ ${escapeHtml(type.substring(0, 30))}</span>
                                <span style="font-size:12px; color:#3b82f6;">dikirim oleh: anonymous</span>
                            </div>
                            <button class="btn-download" data-roomkey="${roomKey}" data-fileindex="${idx}">‚¨áÔ∏è Download</button>
                        </div>
                    `;
                });
                roomFileListContainer.innerHTML = html;

                // Tombol download
                roomFileListContainer.querySelectorAll('.btn-download').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        const rKey = this.dataset.roomkey;
                        const fIdx = parseInt(this.dataset.fileindex);
                        const file = roomDatabase[rKey]?.[fIdx];
                        if (file) {
                            // Buat URL objek dan trigger download
                            const blob = new Blob([file], { type: file.type });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = file.name;
                            a.click();
                            URL.revokeObjectURL(url);
                        }
                        e.stopPropagation();
                    });
                });
            }

            // ========== UPLOAD HANDLER ==========
            function addFiles(files) {
                if (!files || files.length === 0) return;
                for (let i = 0; i < files.length; i++) {
                    uploadedFiles.push(files[i]);
                }
                renderMyFiles();
                fileInput.value = '';
            }

            // ========== EVENT LISTENER ==========
            // Tab switching
            tabMy.addEventListener('click', () => {
                tabMy.classList.add('active');
                tabRoom.classList.remove('active');
                panelMy.classList.add('active');
                panelRoom.classList.remove('active');
            });
            tabRoom.addEventListener('click', () => {
                tabRoom.classList.add('active');
                tabMy.classList.remove('active');
                panelRoom.classList.add('active');
                panelMy.classList.remove('active');
                // render ulang room dengan key yg sedang aktif
                renderRoomFiles(currentRoomKey);
            });

            // File input
            fileInput.addEventListener('change', (e) => addFiles(e.target.files));

            // Drag & drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.background = '#e6f0fa';
                dropZone.style.borderColor = '#3b82f6';
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.style.background = '#f9fcff';
                dropZone.style.borderColor = '#cbd5e1';
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.background = '#f9fcff';
                dropZone.style.borderColor = '#cbd5e1';
                const items = e.dataTransfer.items;
                if (items) {
                    const files = [];
                    for (let i = 0; i < items.length; i++) {
                        const item = items[i];
                        if (item.kind === 'file') {
                            const file = item.getAsFile();
                            if (file) files.push(file);
                        }
                    }
                    addFiles(files);
                } else {
                    addFiles(e.dataTransfer.files);
                }
            });

            // Device selector
            deviceChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    const device = this.dataset.device;
                    if (device === 'all') {
                        deviceChips.forEach(c => c.classList.add('active'));
                        selectedDevices = ['pc1', 'router', 'hp', 'pc2', 'all'];
                    } else {
                        if (this.classList.contains('active')) {
                            if (selectedDevices.length > 1) {
                                this.classList.remove('active');
                                selectedDevices = selectedDevices.filter(d => d !== device);
                            }
                        } else {
                            this.classList.add('active');
                            selectedDevices.push(device);
                        }
                        const allChip = document.querySelector('.device-chip[data-device="all"]');
                        if (allChip.classList.contains('active')) {
                            allChip.classList.remove('active');
                            selectedDevices = selectedDevices.filter(d => d !== 'all');
                        }
                    }
                    if (selectedDevices.length === 0) {
                        document.querySelector('.device-chip[data-device="pc1"]').classList.add('active');
                        selectedDevices = ['pc1'];
                    }
                });
            });

            // Transfer button
            transferBtn.addEventListener('click', function() {
                if (uploadedFiles.length === 0) {
                    transferStatus.innerText = '‚ö†Ô∏è Tidak ada file untuk dikirim';
                    return;
                }
                const activeDevices = [];
                document.querySelectorAll('.device-chip.active').forEach(chip => {
                    activeDevices.push(chip.dataset.device);
                });
                const totalFiles = uploadedFiles.length;
                const totalSize = uploadedFiles.reduce((acc, f) => acc + (f.size || 0), 0);
                const deviceNames = activeDevices.map(d => {
                    const map = { pc1:'PC1', router:'Router', hp:'Android', pc2:'PC2', all:'Semua' };
                    return map[d] || d;
                }).join(', ');
                transferStatus.innerText = `‚úÖ Transfer ${totalFiles} file (${formatBytes(totalSize)}) ke ${deviceNames} ‚Äî BERHASIL`;
                setTimeout(() => {
                    transferStatus.innerText = `Siap ‚Äì ${totalFiles} file`;
                }, 3000);
            });

            // ROOM: Join / Refresh
            joinRoomBtn.addEventListener('click', function() {
                let key = roomKeyInput.value.trim();
                if (key === '') key = 'default-room';
                currentRoomKey = key;
                // Jika room belum ada di database, buat array kosong
                if (!roomDatabase[currentRoomKey]) {
                    roomDatabase[currentRoomKey] = [];
                }
                renderRoomFiles(currentRoomKey);
            });

            // Inisialisasi room dengan key default
            roomKeyInput.value = currentRoomKey;
            renderRoomFiles(currentRoomKey);

            // My Uploads: tidak ada dummy file, array kosong
            renderMyFiles();
        })();
    </script>
</body>
</html>
